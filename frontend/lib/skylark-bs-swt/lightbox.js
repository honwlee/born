/**
 * skylark-bs-swt - The skylark bootstrap standard widget tookit
 * @author Hudaokeji, Inc.
 * @version v0.9.0-beta
 * @link https://github.com/skylarkui/skylark-bs-swt/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/velm","skylark-utils/query","./sbswt"],function(t,i,e,o,s,a,n,l){function h(i){return this.each(function(){var e=n(this),o=e.data("bs.lightbox"),s=t.mixin({},d.DEFAULTS,e.data(),"object"==typeof i&&i),a="string"==typeof i?i:s.slide;o?(o.modal().modal("show"),"number"==typeof i?o.navigateTo(i):a&&o[a]()):e.data("bs.lightbox",o=new d(this,s))})}var d=l.Lightbox=l.WidgetBase.inherit({klassName:"Lightbox",init:function(t,i){var e=this;this._config=i,this._$modalArrows=null,this._galleryIndex=0,this._galleryName=null,this._padding=null,this._border=null,this._titleIsShown=!1,this._footerIsShown=!1,this._wantedWidth=0,this._wantedHeight=0,this._touchstartX=0,this._touchendX=0,this._modalId="ekkoLightbox-"+Math.floor(1e3*Math.random()+1),this._$element=n(t),this._isBootstrap3=3==n.fn.modal.Constructor.VERSION[0];var o='<h4 class="modal-title">'+(this._config.title||"&nbsp;")+"</h4>",s='<button type="button" class="close" data-dismiss="modal" aria-label="'+this._config.strings.close+'"><span aria-hidden="true">&times;</span></button>',a='<div class="modal-header'+(this._config.title||this._config.alwaysShowClose?"":" hide")+'">'+(this._isBootstrap3?s+o:o+s)+"</div>",l='<div class="modal-footer'+(this._config.footer?"":" hide")+'">'+(this._config.footer||"&nbsp;")+"</div>",h='<div class="modal-body"><div class="ekko-lightbox-container"><div class="ekko-lightbox-item fade in show"></div><div class="ekko-lightbox-item fade"></div></div></div>',d='<div class="modal-dialog" role="document"><div class="modal-content">'+a+h+l+"</div></div>";n(this._config.doc.body).append('<div id="'+this._modalId+'" class="ekko-lightbox modal fade" tabindex="-1" tabindex="-1" role="dialog" aria-hidden="true">'+d+"</div>"),this._$modal=n("#"+this._modalId,this._config.doc),this._$modalDialog=this._$modal.find(".modal-dialog").first(),this._$modalContent=this._$modal.find(".modal-content").first(),this._$modalBody=this._$modal.find(".modal-body").first(),this._$modalHeader=this._$modal.find(".modal-header").first(),this._$modalFooter=this._$modal.find(".modal-footer").first(),this._$lightboxContainer=this._$modalBody.find(".ekko-lightbox-container").first(),this._$lightboxBodyOne=this._$lightboxContainer.children().first(),this._$lightboxBodyTwo=this._$lightboxContainer.children().last(),this._border=this._calculateBorders(),this._padding=this._calculatePadding(),this._galleryName=this._$element.data("gallery"),this._galleryName&&(this._$galleryItems=n(document.body).find('*[data-gallery="'+this._galleryName+'"]'),this._galleryIndex=this._$galleryItems.index(this._$element),n(document).on("keydown.ekkoLightbox",this._navigationalBinder.bind(this)),this._config.showArrows&&this._$galleryItems.length>1&&(this._$lightboxContainer.append('<div class="ekko-lightbox-nav-overlay"><a href="#">'+this._config.leftArrow+'</a><a href="#">'+this._config.rightArrow+"</a></div>"),this._$modalArrows=this._$lightboxContainer.find("div.ekko-lightbox-nav-overlay").first(),this._$lightboxContainer.on("click","a:first-child",function(t){return t.preventDefault(),e.navigateLeft()}),this._$lightboxContainer.on("click","a:last-child",function(t){return t.preventDefault(),e.navigateRight()}),this.updateNavigation())),this._$modal.on("show.bs.modal",this._config.onShow.bind(this)).on("shown.bs.modal",function(){return e._toggleLoading(!0),e._handle(),e._config.onShown.call(e)}).on("hide.bs.modal",this._config.onHide.bind(this)).on("hidden.bs.modal",function(){return e._galleryName&&(n(document).off("keydown.ekkoLightbox"),n(window).off("resize.ekkoLightbox")),e._$modal.remove(),e._config.onHidden.call(e)}).modal(this._config),n(window).on("resize.ekkoLightbox",function(){e._resize(e._wantedWidth,e._wantedHeight)}),this._$lightboxContainer.on("touchstart",function(){e._touchstartX=event.changedTouches[0].screenX}).on("touchend",function(){e._touchendX=event.changedTouches[0].screenX,e._swipeGesure()})},get:function(){return d.DEFAULTS},element:function(){return this._$element},modal:function(){return this._$modal},navigateTo:function(t){return t<0||t>this._$galleryItems.length-1?this:(this._galleryIndex=t,this.updateNavigation(),this._$element=n(this._$galleryItems.get(this._galleryIndex)),void this._handle())},navigateLeft:function(){if(this._$galleryItems&&1!==this._$galleryItems.length){if(0===this._galleryIndex){if(!this._config.wrapping)return;this._galleryIndex=this._$galleryItems.length-1}else this._galleryIndex--;return this._config.onNavigate.call(this,"left",this._galleryIndex),this.navigateTo(this._galleryIndex)}},navigateRight:function(){if(this._$galleryItems&&1!==this._$galleryItems.length){if(this._galleryIndex===this._$galleryItems.length-1){if(!this._config.wrapping)return;this._galleryIndex=0}else this._galleryIndex++;return this._config.onNavigate.call(this,"right",this._galleryIndex),this.navigateTo(this._galleryIndex)}},updateNavigation:function(){if(!this._config.wrapping){var t=this._$lightboxContainer.find("div.ekko-lightbox-nav-overlay");0===this._galleryIndex?t.find("a:first-child").addClass("disabled"):t.find("a:first-child").removeClass("disabled"),this._galleryIndex===this._$galleryItems.length-1?t.find("a:last-child").addClass("disabled"):t.find("a:last-child").removeClass("disabled")}},close:function(){return this._$modal.modal("hide")},_navigationalBinder:function(t){return t=t||window.event,39===t.keyCode?this.navigateRight():37===t.keyCode?this.navigateLeft():void 0},_detectRemoteType:function(t,i){return i=i||!1,!i&&this._isImage(t)&&(i="image"),!i&&this._getYoutubeId(t)&&(i="youtube"),!i&&this._getVimeoId(t)&&(i="vimeo"),!i&&this._getInstagramId(t)&&(i="instagram"),(!i||["image","youtube","vimeo","instagram","video","url"].indexOf(i)<0)&&(i="url"),i},_isImage:function(t){return t&&t.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},_containerToUse:function(){var t=this,i=this._$lightboxBodyTwo,e=this._$lightboxBodyOne;return this._$lightboxBodyTwo.hasClass("in")&&(i=this._$lightboxBodyOne,e=this._$lightboxBodyTwo),e.removeClass("in show"),setTimeout(function(){t._$lightboxBodyTwo.hasClass("in")||t._$lightboxBodyTwo.empty(),t._$lightboxBodyOne.hasClass("in")||t._$lightboxBodyOne.empty()},500),i.addClass("in show"),i},_handle:function(){var t=this._containerToUse();this._updateTitleAndFooter();var i=this._$element.attr("data-remote")||this._$element.attr("data-link")||this._$element.attr("href"),e=this._detectRemoteType(i,this._$element.attr("data-type")||!1);if(["image","youtube","vimeo","instagram","video","url"].indexOf(e)<0)return this._error(this._config.strings.type);switch(e){case"image":this._preloadImage(i,t),this._preloadImageByIndex(this._galleryIndex,3);break;case"youtube":this._showYoutubeVideo(i,t);break;case"vimeo":this._showVimeoVideo(this._getVimeoId(i),t);break;case"instagram":this._showInstagramVideo(this._getInstagramId(i),t);break;case"video":this._showHtml5Video(i,t);break;default:this._loadRemoteContent(i,t)}return this},_getYoutubeId:function(t){if(!t)return!1;var i=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!(!i||11!==i[2].length)&&i[2]},_getVimeoId:function(t){return!!(t&&t.indexOf("vimeo")>0)&&t},_getInstagramId:function(t){return!!(t&&t.indexOf("instagram")>0)&&t},_toggleLoading:function(t){return t=t||!1,t?(this._$modalDialog.css("display","none"),this._$modal.removeClass("in show"),n(".modal-backdrop").append(this._config.loadingMessage)):(this._$modalDialog.css("display","block"),this._$modal.addClass("in show"),n(".modal-backdrop").find(".ekko-lightbox-loader").remove()),this},_calculateBorders:function(){return{top:this._totalCssByAttribute("border-top-width"),right:this._totalCssByAttribute("border-right-width"),bottom:this._totalCssByAttribute("border-bottom-width"),left:this._totalCssByAttribute("border-left-width")}},_calculatePadding:function(){return{top:this._totalCssByAttribute("padding-top"),right:this._totalCssByAttribute("padding-right"),bottom:this._totalCssByAttribute("padding-bottom"),left:this._totalCssByAttribute("padding-left")}},_totalCssByAttribute:function(t){return parseInt(this._$modalDialog.css(t),10)+parseInt(this._$modalContent.css(t),10)+parseInt(this._$modalBody.css(t),10)},_updateTitleAndFooter:function(){var t=this._$element.data("title")||"",i=this._$element.data("footer")||"";return this._titleIsShown=!1,t||this._config.alwaysShowClose?(this._titleIsShown=!0,this._$modalHeader.css("display","").find(".modal-title").html(t||"&nbsp;")):this._$modalHeader.css("display","none"),this._footerIsShown=!1,i?(this._footerIsShown=!0,this._$modalFooter.css("display","").html(i)):this._$modalFooter.css("display","none"),this},_showYoutubeVideo:function(t,i){var e=this._getYoutubeId(t),o=t.indexOf("&")>0?t.substr(t.indexOf("&")):"",s=this._$element.data("width")||560,a=this._$element.data("height")||s/(560/315);return this._showVideoIframe("//www.youtube.com/embed/"+e+"?badge=0&autoplay=1&html5=1"+o,s,a,i)},_showVimeoVideo:function(t,i){var e=this._$element.data("width")||500,o=this._$element.data("height")||e/(560/315);return this._showVideoIframe(t+"?autoplay=1",e,o,i)},_showInstagramVideo:function(t,i){var e=this._$element.data("width")||612,o=e+80;return t="/"!==t.substr(-1)?t+"/":t,i.html('<iframe width="'+e+'" height="'+o+'" src="'+t+'embed/" frameborder="0" allowfullscreen></iframe>'),this._resize(e,o),this._config.onContentLoaded.call(this),this._$modalArrows&&this._$modalArrows.css("display","none"),this._toggleLoading(!1),this},_showVideoIframe:function(t,i,e,o){return e=e||i,o.html('<div class="embed-responsive embed-responsive-16by9"><iframe width="'+i+'" height="'+e+'" src="'+t+'" frameborder="0" allowfullscreen class="embed-responsive-item"></iframe></div>'),this._resize(i,e),this._config.onContentLoaded.call(this),this._$modalArrows&&this._$modalArrows.css("display","none"),this._toggleLoading(!1),this},_showHtml5Video:function(t,i){var e=this._$element.data("width")||560,o=this._$element.data("height")||e/(560/315);return i.html('<div class="embed-responsive embed-responsive-16by9"><video width="'+e+'" height="'+o+'" src="'+t+'" preload="auto" autoplay controls class="embed-responsive-item"></video></div>'),this._resize(e,o),this._config.onContentLoaded.call(this),this._$modalArrows&&this._$modalArrows.css("display","none"),this._toggleLoading(!1),this},_loadRemoteContent:function(t,i){var e=this,o=this._$element.data("width")||560,s=this._$element.data("height")||560,a=this._$element.data("disableExternalCheck")||!1;return this._toggleLoading(!1),a||this._isExternal(t)?(i.html('<iframe src="'+t+'" frameborder="0" allowfullscreen></iframe>'),this._config.onContentLoaded.call(this)):i.load(t,n.proxy(function(){return e._$element.trigger("loaded.bs.modal")})),this._$modalArrows&&this._$modalArrows.css("display","none"),this._resize(o,s),this},_isExternal:function(t){var i=t.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof i[1]&&i[1].length>0&&i[1].toLowerCase()!==location.protocol||"string"==typeof i[2]&&i[2].length>0&&i[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host},_error:function(t){return console.error(t),this._containerToUse().html(t),this._resize(300,300),this},_preloadImageByIndex:function(t,i){if(this._$galleryItems){var e=n(this._$galleryItems.get(t),!1);if("undefined"!=typeof e){var o=e.attr("data-remote")||e.attr("data-link")||e.attr("href");return("image"===e.attr("data-type")||this._isImage(o))&&this._preloadImage(o,!1),i>0?this._preloadImageByIndex(t+1,i-1):void 0}}},_preloadImage:function(t,i){var e=this;i=i||!1;var o=new Image;return i&&!function(){var s=setTimeout(function(){i.append(e._config.loadingMessage)},200);o.onload=function(){s&&clearTimeout(s),s=null;var t=n("<img />");return t.attr("src",o.src),t.addClass("img-fluid"),t.css("width","100%"),i.html(t),e._$modalArrows&&e._$modalArrows.css("display",""),e._resize(o.width,o.height),e._toggleLoading(!1),e._config.onContentLoaded.call(e)},o.onerror=function(){return e._toggleLoading(!1),e._error(e._config.strings.fail+("  "+t))}}(),o.src=t,o},_swipeGesure:function(){return this._touchendX<this._touchstartX?this.navigateRight():this._touchendX>this._touchstartX?this.navigateLeft():void 0},_resize:function(t,i){i=i||t,this._wantedWidth=t,this._wantedHeight=i;var e=t/i,o=this._padding.left+this._padding.right+this._border.left+this._border.right,s=this._config.doc.body.clientWidth>575?20:0,a=this._config.doc.body.clientWidth>575?0:20,l=Math.min(t+o,this._config.doc.body.clientWidth-s,this._config.maxWidth);t+o>l?(i=(l-o-a)/e,t=l):t+=o;var h=0,d=0;this._footerIsShown&&(d=this._$modalFooter.outerHeight(!0)||55),this._titleIsShown&&(h=this._$modalHeader.outerHeight(!0)||67);var r=this._padding.top+this._padding.bottom+this._border.bottom+this._border.top,g=parseFloat(this._$modalDialog.css("margin-top"))+parseFloat(this._$modalDialog.css("margin-bottom")),_=Math.min(i,n(window).height()-r-g-h-d,this._config.maxHeight-r-h-d);i>_&&(t=Math.ceil(_*e)+o),this._$lightboxContainer.css("height",_),this._$modalDialog.css("flex",1).css("maxWidth",t);var c=this._$modal.data("bs.modal");if(c)try{c._handleUpdate()}catch(m){c.handleUpdate()}return this},_jQueryInterface:function(t){var i=this;return t=t||{},this.each(function(){var e=n(i),o=n.extend({},d.Default,e.data(),"object"==typeof t&&t);new d(i,o)})}});d.DEFAULTS={title:"",footer:"",maxWidth:9999,maxHeight:9999,showArrows:!0,wrapping:!0,type:null,alwaysShowClose:!1,loadingMessage:'<div class="ekko-lightbox-loader"><div><div></div><div></div></div></div>',leftArrow:"<span>&#10094;</span>",rightArrow:"<span>&#10095;</span>",strings:{close:"Close",fail:"Failed to load image:",type:"Could not detect remote target type. Force the type using data-type"},doc:document,onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){},onNavigate:function(){},onContentLoaded:function(){}};var r=n.fn.lightbox;return n.fn.lightbox=h,n.fn.lightbox.Constructor=d,n.fn.lightbox.noConflict=function(){return n.fn.lightbox=r,this},n.fn.lightbox});
//# sourceMappingURL=sourcemaps/lightbox.js.map
