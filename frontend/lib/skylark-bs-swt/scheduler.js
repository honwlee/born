/**
 * skylark-bs-swt - The skylark bootstrap standard widget tookit
 * @author Hudaokeji, Inc.
 * @version v0.9.0-beta
 * @link https://github.com/skylarkui/skylark-bs-swt/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/velm","skylark-utils/query","./sbswt","./combobox","./datepicker","./radio","./selectlist","./spinbox"],function(e,t,i,s,a,n,l,r){var d=l.fn.scheduler,o=r.Scheduler=r.WidgetBase.inherit({klassName:"Scheduler",init:function(t,i){var s=this;this.$element=l(t),this.options=e.mixin({},l.fn.scheduler.defaults,i),this.$startDate=this.$element.find(".start-datetime .start-date"),this.$startTime=this.$element.find(".start-datetime .start-time"),this.$timeZone=this.$element.find(".timezone-container .timezone"),this.$repeatIntervalPanel=this.$element.find(".repeat-every-panel"),this.$repeatIntervalSelect=this.$element.find(".repeat-options"),this.$repeatIntervalSpinbox=this.$element.find(".repeat-every"),this.$repeatIntervalTxt=this.$element.find(".repeat-every-text"),this.$end=this.$element.find(".repeat-end"),this.$endSelect=this.$end.find(".end-options"),this.$endAfter=this.$end.find(".end-after"),this.$endDate=this.$end.find(".end-on-date"),this.$recurrencePanels=this.$element.find(".repeat-panel"),this.$repeatIntervalSelect.selectlist(),this.$element.find(".selectlist").selectlist(),this.$startDate.datepicker(this.options.startDateOptions);var a="function"==typeof this.options.startDateChanged?this.options.startDateChanged:this._guessEndDate;this.$startDate.on("change changed.fu.datepicker dateClicked.fu.datepicker",e.proxy(a,this)),this.$startTime.combobox(),""===this.$startTime.find("input").val()&&this.$startTime.combobox("selectByIndex",0),"0"===this.$repeatIntervalSpinbox.find("input").val()?this.$repeatIntervalSpinbox.spinbox({value:1,min:1,limitToStep:!0}):this.$repeatIntervalSpinbox.spinbox({min:1,limitToStep:!0}),this.$endAfter.spinbox({value:1,min:1,limitToStep:!0}),this.$endDate.datepicker(this.options.endDateOptions),this.$element.find(".radio-custom").radio(),this.$repeatIntervalSelect.on("changed.fu.selectlist",e.proxy(this.repeatIntervalSelectChanged,this)),this.$endSelect.on("changed.fu.selectlist",e.proxy(this.endSelectChanged,this)),this.$element.find(".repeat-days-of-the-week .btn-group .btn").on("change.fu.scheduler",function(e,t){s.changed(e,t,!0)}),this.$element.find(".combobox").on("changed.fu.combobox",e.proxy(this.changed,this)),this.$element.find(".datepicker").on("changed.fu.datepicker",e.proxy(this.changed,this)),this.$element.find(".datepicker").on("dateClicked.fu.datepicker",e.proxy(this.changed,this)),this.$element.find(".selectlist").on("changed.fu.selectlist",e.proxy(this.changed,this)),this.$element.find(".spinbox").on("changed.fu.spinbox",e.proxy(this.changed,this)),this.$element.find(".repeat-monthly .radio-custom, .repeat-yearly .radio-custom").on("change.fu.scheduler",e.proxy(this.changed,this))},destroy:function(){var e;return this.$element.find("input").each(function(){l(this).attr("value",l(this).val())}),this.$element.find(".datepicker .calendar").empty(),e=this.$element[0].outerHTML,this.$element.find(".combobox").combobox("destroy"),this.$element.find(".datepicker").datepicker("destroy"),this.$element.find(".selectlist").selectlist("destroy"),this.$element.find(".spinbox").spinbox("destroy"),this.$element.find(".radio-custom").radio("destroy"),this.$element.remove(),e},changed:function(e,t,i){i||e.stopPropagation(),this.$element.trigger("changed.fu.scheduler",{data:void 0!==t?t:l(e.currentTarget).data(),originalEvent:e,value:this.getValue()})},disable:function(){this.toggleState("disable")},enable:function(){this.toggleState("enable")},setUtcTime:function(e,t,i){var s=e.split("-"),a=t.split(":"),n=new Date(Date.UTC(s[0],s[1]-1,s[2],a[0],a[1],a[2]?a[2]:0));if("Z"===i)n.setUTCHours(n.getUTCHours()+0);else{var l=[];l[0]="(.)",l[1]=".*?",l[2]="\\d",l[3]=".*?",l[4]="(\\d)";var r=new RegExp(l.join(""),["i"]),d=r.exec(i);if(null!==d){var o=d[1],h=d[2],c="+"===o?1:-1;n.setUTCHours(n.getUTCHours()+c*parseInt(h,10))}}var m=n.getTimezoneOffset();return n.setMinutes(m),n},endSelectChanged:function(e,t){var i,s;t?s=t.value:(i=this.$endSelect.selectlist("selectedItem"),s=i.value),this.$endAfter.parent().addClass("hidden"),this.$endAfter.parent().attr("aria-hidden","true"),this.$endDate.parent().addClass("hidden"),this.$endDate.parent().attr("aria-hidden","true"),"after"===s?(this.$endAfter.parent().removeClass("hide hidden"),this.$endAfter.parent().attr("aria-hidden","false")):"date"===s&&(this.$endDate.parent().removeClass("hide hidden"),this.$endDate.parent().attr("aria-hidden","false"))},_guessEndDate:function(){var e=this.$repeatIntervalSelect.selectlist("selectedItem").value,t=new Date(this.$endDate.datepicker("getDate")),i=new Date(this.$startDate.datepicker("getDate")),s=this.$repeatIntervalSpinbox.find("input").val();"none"!==e&&t<=i&&(this.$repeatIntervalSpinbox.is(":visible")||(s=1),"weekdays"===e&&(s=1,e="weekly"),t=T(i,t,e,s),this.$endDate.datepicker("setDate",t))},getValue:function(){var t,i=this.$repeatIntervalSpinbox.spinbox("value"),s="",a=this.$repeatIntervalSelect.selectlist("selectedItem").value;this.$startTime.combobox("selectedItem").value?(t=this.$startTime.combobox("selectedItem").value,t=t.toLowerCase()):t=this.$startTime.combobox("selectedItem").text.toLowerCase();var n,r,d,o,c,m,p,f,u=this.$timeZone.selectlist("selectedItem");p=""+h(this.$startDate.datepicker("getDate"),"-"),p+="T",d=t.search("am")>=0,o=t.search("pm")>=0,t=e.trim(t.replace(/am/g,"").replace(/pm/g,"")).split(":"),t[0]=parseInt(t[0],10),t[1]=parseInt(t[1],10),d&&t[0]>11?t[0]=0:o&&t[0]<12&&(t[0]+=12),p+=t[0]<10?"0"+t[0]:t[0],p+=":",p+=t[1]<10?"0"+t[1]:t[1],p+="+00:00"===u.offset?"Z":u.offset,"none"===a?s="FREQ=DAILY;INTERVAL=1;COUNT=1;":"secondly"===a?(s="FREQ=SECONDLY;",s+="INTERVAL="+i+";"):"minutely"===a?(s="FREQ=MINUTELY;",s+="INTERVAL="+i+";"):"hourly"===a?(s="FREQ=HOURLY;",s+="INTERVAL="+i+";"):"daily"===a?(s+="FREQ=DAILY;",s+="INTERVAL="+i+";"):"weekdays"===a?(s+="FREQ=WEEKLY;",s+="BYDAY=MO,TU,WE,TH,FR;",s+="INTERVAL=1;"):"weekly"===a?(r=[],this.$element.find(".repeat-days-of-the-week .btn-group input:checked").each(function(){r.push(l(this).data().value)}),s+="FREQ=WEEKLY;",s+="BYDAY="+r.join(",")+";",s+="INTERVAL="+i+";"):"monthly"===a?(s+="FREQ=MONTHLY;",s+="INTERVAL="+i+";",f=this.$element.find("input[name=repeat-monthly]:checked").val(),"bymonthday"===f?(n=parseInt(this.$element.find(".repeat-monthly-date .selectlist").selectlist("selectedItem").text,10),s+="BYMONTHDAY="+n+";"):"bysetpos"===f&&(r=this.$element.find(".repeat-monthly-day .month-days").selectlist("selectedItem").value,m=this.$element.find(".repeat-monthly-day .month-day-pos").selectlist("selectedItem").value,s+="BYDAY="+r+";",s+="BYSETPOS="+m+";")):"yearly"===a&&(s+="FREQ=YEARLY;",f=this.$element.find("input[name=repeat-yearly]:checked").val(),"bymonthday"===f?(c=this.$element.find(".repeat-yearly-date .year-month").selectlist("selectedItem").value,n=this.$element.find(".repeat-yearly-date .year-month-day").selectlist("selectedItem").text,s+="BYMONTH="+c+";",s+="BYMONTHDAY="+n+";"):"bysetpos"===f&&(r=this.$element.find(".repeat-yearly-day .year-month-days").selectlist("selectedItem").value,m=this.$element.find(".repeat-yearly-day .year-month-day-pos").selectlist("selectedItem").value,c=this.$element.find(".repeat-yearly-day .year-month").selectlist("selectedItem").value,s+="BYDAY="+r+";",s+="BYSETPOS="+m+";",s+="BYMONTH="+c+";"));var y=this.$endSelect.selectlist("selectedItem").value,$="";"none"!==a&&("after"===y?$="COUNT="+this.$endAfter.spinbox("value")+";":"date"===y&&($="UNTIL="+h(this.$endDate.datepicker("getDate"),"")+";")),s+=$,s=";"===s.substring(s.length-1)?s.substring(0,s.length-1):s;var v={startDateTime:p,timeZone:u,recurrencePattern:s};return v},repeatIntervalSelectChanged:function(e,t){var i,s,a;switch(t?(s=t.value,a=t.text):(i=this.$repeatIntervalSelect.selectlist("selectedItem"),s=i.value||"",a=i.text||""),this.$repeatIntervalTxt.text(a),s.toLowerCase()){case"hourly":case"daily":case"weekly":case"monthly":this.$repeatIntervalPanel.removeClass("hide hidden"),this.$repeatIntervalPanel.attr("aria-hidden","false");break;default:this.$repeatIntervalPanel.addClass("hidden"),this.$repeatIntervalPanel.attr("aria-hidden","true")}this.$recurrencePanels.addClass("hidden"),this.$recurrencePanels.attr("aria-hidden","true"),this.$element.find(".repeat-"+s).removeClass("hide hidden"),this.$element.find(".repeat-"+s).attr("aria-hidden","false"),"none"===s?(this.$end.addClass("hidden"),this.$end.attr("aria-hidden","true")):(this.$end.removeClass("hide hidden"),this.$end.attr("aria-hidden","false")),this._guessEndDate()},_parseAndSetRecurrencePattern:function(e,t){var i,s,a,n,l={},r=0,d="",o=e.toUpperCase().split(";");for(r=0;r<o.length;r++)""!==o[r]&&(d=o[r].split("="),l[d[0]]=d[1]);if("DAILY"===l.FREQ)d="MO,TU,WE,TH,FR"===l.BYDAY?"weekdays":"1"===l.INTERVAL&&"1"===l.COUNT?"none":"daily";else if("SECONDLY"===l.FREQ)d="secondly";else if("MINUTELY"===l.FREQ)d="minutely";else if("HOURLY"===l.FREQ)d="hourly";else if("WEEKLY"===l.FREQ){if(d="weekly",l.BYDAY)if("MO,TU,WE,TH,FR"===l.BYDAY)d="weekdays";else{var h=this.$element.find(".repeat-days-of-the-week .btn-group");for(h.find("label").removeClass("active"),i=l.BYDAY.split(","),r=0;r<i.length;r++)h.find('input[data-value="'+i[r]+'"]').prop("checked",!0).parent().addClass("active")}}else if("MONTHLY"===l.FREQ){if(this.$element.find(".repeat-monthly input").removeAttr("checked").removeClass("checked"),this.$element.find(".repeat-monthly label.radio-custom").removeClass("checked"),l.BYMONTHDAY)s=this.$element.find(".repeat-monthly-date"),s.find("input").addClass("checked").prop("checked",!0),s.find("label.radio-custom").addClass("checked"),s.find(".selectlist").selectlist("selectByValue",l.BYMONTHDAY);else if(l.BYDAY){var c=this.$element.find(".repeat-monthly-day");c.find("input").addClass("checked").prop("checked",!0),c.find("label.radio-custom").addClass("checked"),l.BYSETPOS&&c.find(".month-day-pos").selectlist("selectByValue",l.BYSETPOS),c.find(".month-days").selectlist("selectByValue",l.BYDAY)}d="monthly"}else"YEARLY"===l.FREQ?(this.$element.find(".repeat-yearly input").removeAttr("checked").removeClass("checked"),this.$element.find(".repeat-yearly label.radio-custom").removeClass("checked"),l.BYMONTHDAY?(a=this.$element.find(".repeat-yearly-date"),a.find("input").addClass("checked").prop("checked",!0),a.find("label.radio-custom").addClass("checked"),l.BYMONTH&&a.find(".year-month").selectlist("selectByValue",l.BYMONTH),a.find(".year-month-day").selectlist("selectByValue",l.BYMONTHDAY)):l.BYSETPOS&&(n=this.$element.find(".repeat-yearly-day"),n.find("input").addClass("checked").prop("checked",!0),n.find("label.radio-custom").addClass("checked"),n.find(".year-month-day-pos").selectlist("selectByValue",l.BYSETPOS),l.BYDAY&&n.find(".year-month-days").selectlist("selectByValue",l.BYDAY),l.BYMONTH&&n.find(".year-month").selectlist("selectByValue",l.BYMONTH)),d="yearly"):d="none";if(l.COUNT)this.$endAfter.spinbox("value",parseInt(l.COUNT,10)),this.$endSelect.selectlist("selectByValue","after");else if(l.UNTIL){var m,p;8===l.UNTIL.length&&(m=l.UNTIL.split(""),m.splice(4,0,"-"),m.splice(7,0,"-"),p=m.join(""));var f=this.$timeZone.selectlist("selectedItem"),u="+00:00"===f.offset?"Z":f.offset,y=this.setUtcTime(p,t.time24HourFormat,u);this.$endDate.datepicker("setDate",y),this.$endSelect.selectlist("selectByValue","date")}else this.$endSelect.selectlist("selectByValue","never");this.endSelectChanged(),l.INTERVAL&&this.$repeatIntervalSpinbox.spinbox("value",parseInt(l.INTERVAL,10)),this.$repeatIntervalSelect.selectlist("selectByValue",d),this.repeatIntervalSelectChanged()},_parseStartDateTime:function(t){var i,s,a,n={};return n.time24HourFormat=t.split("+")[0].split("-")[0],t.search(/\+/)>-1?n.timeZoneOffset="+"+e.trim(t.split("+")[1]):t.search(/\-/)>-1?n.timeZoneOffset="-"+e.trim(t.split("-")[1]):n.timeZoneOffset="+00:00",n.time24HourFormatSplit=n.time24HourFormat.split(":"),i=parseInt(n.time24HourFormatSplit[0],10),s=n.time24HourFormatSplit[1]?parseInt(n.time24HourFormatSplit[1].split("+")[0].split("-")[0].split("Z")[0],10):0,a=i<12?"AM":"PM",0===i?i=12:i>12&&(i-=12),s=s<10?"0"+s:s,n.time12HourFormat=i+":"+s,n.time12HourFormatWithPeriod=i+":"+s+" "+a,n},_parseTimeZone:function(t,i){return i.timeZoneQuerySelector="",t.timeZone?("string"==typeof t.timeZone?i.timeZoneQuerySelector+='li[data-name="'+t.timeZone+'"]':e.each(t.timeZone,function(e,t){i.timeZoneQuerySelector+="li[data-"+e+'="'+t+'"]'}),i.timeZoneOffset=t.timeZone.offset):t.startDateTime?(i.timeZoneOffset="+00:00"===i.timeZoneOffset?"Z":i.timeZoneOffset,i.timeZoneQuerySelector+='li[data-offset="'+i.timeZoneOffset+'"]'):i.timeZoneOffset="Z",i.timeZoneOffset},_setTimeUI:function(e){this.$startTime.find("input").val(e),this.$startTime.combobox("selectByText",e)},_setTimeZoneUI:function(e){this.$timeZone.selectlist("selectBySelector",e)},setValue:function(e){var t,i,s,a,n={};if(e.startDateTime)t=e.startDateTime.split("T"),i=t[0],s=t[1],s?(n=this._parseStartDateTime(s),this._setTimeUI(n.time12HourFormatWithPeriod)):(n.time12HourFormat="00:00",n.time24HourFormat="00:00");else{n.time12HourFormat="00:00",n.time24HourFormat="00:00";var l=this.$startDate.datepicker("getDate");i=l.getFullYear()+"-"+l.getMonth()+"-"+l.getDate()}this._parseTimeZone(e,n),n.timeZoneQuerySelector&&this._setTimeZoneUI(n.timeZoneQuerySelector),e.recurrencePattern&&this._parseAndSetRecurrencePattern(e.recurrencePattern,n),a=this.setUtcTime(i,n.time24HourFormat,n.timeZoneOffset),this.$startDate.datepicker("setDate",a)},toggleState:function(e){this.$element.find(".combobox").combobox(e),this.$element.find(".datepicker").datepicker(e),this.$element.find(".selectlist").selectlist(e),this.$element.find(".spinbox").spinbox(e),this.$element.find(".radio-custom").radio(e),e="disable"===e?"addClass":"removeClass",this.$element.find(".repeat-days-of-the-week .btn-group")[e]("disabled")},value:function(e){return e?this.setValue(e):this.getValue()}}),h=function(e,t){var i,s="";return s+=e.getFullYear(),s+=t,i=e.getMonth()+1,s+=i<10?"0"+i:i,s+=t,i=e.getDate(),s+=i<10?"0"+i:i},c=1e3,m=60*c,p=60*m,f=24*p,u=7*f,y=5*u,$=52*u,v={secondly:c,minutely:m,hourly:p,daily:f,weekly:u,monthly:y,yearly:$},T=function(e,t,i,s){return new Date(e.getTime()+v[i]*s)};return l.fn.scheduler=function(e){var t,i=Array.prototype.slice.call(arguments,1),s=this.each(function(){var s=l(this),a=s.data("fu.scheduler"),n="object"==typeof e&&e;a||s.data("fu.scheduler",a=new o(this,n)),"string"==typeof e&&(t=a[e].apply(a,i))});return void 0===t?s:t},l.fn.scheduler.defaults={},l.fn.scheduler.Constructor=o,l.fn.scheduler.noConflict=function(){return l.fn.scheduler=d,this},l.fn.scheduler});
//# sourceMappingURL=sourcemaps/scheduler.js.map
