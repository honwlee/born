{"version":3,"sources":["picker.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","sbswt","old","fn","picker","Picker","WidgetBase","inherit","klassName","init","element","options","self","this","$element","mixin","defaults","$accept","find","$cancel","$trigger","$footer","$header","$popup","$body","clickStamp","isInput","is","on","proxy","keyComplete","e","target","show","toggle","complete","preventDefault","action","EVENT_CALLBACK_MAP","accepted","cancelled","exited","func","obj","contents","trigger","hide","keyCode","blur","destroy","remove","document","off","outerHTML","disable","addClass","attr","enable","removeClass","removeAttr","hasClass","externalClickListener","force","isExternalClick","i","l","el","get","exceptions","externalClickExceptions","$originEl","parents","length","other","data","explicit","_display","Date","getTime","Math","floor","random","_isOffscreen","windowHeight","max","documentElement","clientHeight","window","innerHeight","scrollTop","popupTop","offset","popupBottom","top","outerHeight","css","_showBelow","_showAbove","option","methodReturn","args","Array","prototype","slice","call","arguments","$set","each","$this","apply","undefined","onAccept","onCancel","onExit","Constructor","noConflict"],"mappings":"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","file":"../picker.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"./sbswt\"\n],function(langx,browser,eventer,noder,geom,velm,$,sbswt){\n\n\n\t/*\n\t * Fuel UX Checkbox\n\t * https://github.com/ExactTarget/fuelux\n\t *\n\t * Copyright (c) 2014 ExactTarget\n\t * Licensed under the BSD New license.\n\t */\n\tvar old = $.fn.picker;\n\n\t// PLACARD CONSTRUCTOR AND PROTOTYPE\n\n\n\tvar Picker = sbswt.Picker = sbswt.WidgetBase.inherit({\n\t\tklassName: \"Picker\",\n\n\t\tinit : function(element,options) {\n\t\t\tvar self = this;\n\t\t\tthis.$element = $(element);\n\t\t\tthis.options = langx.mixin({}, $.fn.picker.defaults, options);\n\n\t\t\tthis.$accept = this.$element.find('.picker-accept');\n\t\t\tthis.$cancel = this.$element.find('.picker-cancel');\n\t\t\tthis.$trigger = this.$element.find('.picker-trigger');\n\t\t\tthis.$footer = this.$element.find('.picker-footer');\n\t\t\tthis.$header = this.$element.find('.picker-header');\n\t\t\tthis.$popup = this.$element.find('.picker-popup');\n\t\t\tthis.$body = this.$element.find('.picker-body');\n\n\t\t\tthis.clickStamp = '_';\n\n\t\t\tthis.isInput = this.$trigger.is('input');\n\n\t\t\tthis.$trigger.on('keydown.fu.picker', langx.proxy(this.keyComplete, this));\n\t\t\tthis.$trigger.on('focus.fu.picker', langx.proxy(function inputFocus(e){\n\t\t\t\tif(typeof e === \"undefined\" || $(e.target).is('input[type=text]')){\n\t\t\t\t\tlangx.proxy(this.show(), this);\n\t\t\t\t}\n\t\t\t}, this));\n\t\t\tthis.$trigger.on('click.fu.picker', langx.proxy(function triggerClick(e){\n\t\t\t\tif(!$(e.target).is('input[type=text]')){\n\t\t\t\t\tlangx.proxy(this.toggle(), this);\n\t\t\t\t}else{\n\t\t\t\t\tlangx.proxy(this.show(), this);\n\t\t\t\t}\n\t\t\t}, this));\n\t\t\tthis.$accept.on('click.fu.picker', langx.proxy(this.complete, this, 'accepted'));\n\t\t\tthis.$cancel.on('click.fu.picker', function (e) {\n\t\t\t\te.preventDefault(); self.complete('cancelled');\n\t\t\t});\n\t\t},\n\n\t\tcomplete: function complete(action) {\n\t\t\tvar EVENT_CALLBACK_MAP = {\n\t\t\t\t'accepted': 'onAccept',\n\t\t\t\t'cancelled': 'onCancel',\n\t\t\t\t'exited': 'onExit'\n\t\t\t};\n\t\t\tvar func = this.options[ EVENT_CALLBACK_MAP[action] ];\n\n\t\t\tvar obj = {\n\t\t\t\tcontents: this.$body\n\t\t\t};\n\n\t\t\tif (func) {\n\t\t\t\tfunc(obj);\n\t\t\t\tthis.$element.trigger(action + '.fu.picker', obj);\n\t\t\t} else {\n\t\t\t\tthis.$element.trigger(action + '.fu.picker', obj);\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t},\n\n\t\tkeyComplete: function keyComplete(e) {\n\t\t\tif (this.isInput && e.keyCode === 13) {\n\t\t\t\tthis.complete('accepted');\n\t\t\t\tthis.$trigger.blur();\n\t\t\t} else if (e.keyCode === 27) {\n\t\t\t\tthis.complete('exited');\n\t\t\t\tthis.$trigger.blur();\n\t\t\t}\n\t\t},\n\n\t\tdestroy: function destroy() {\n\t\t\tthis.$element.remove();\n\t\t\t// remove any external bindings\n\t\t\t$(document).off('click.fu.picker.externalClick.' + this.clickStamp);\n\t\t\t// empty elements to return to original markup\n\t\t\t// [none]\n\t\t\t// return string of markup\n\t\t\treturn this.$element[0].outerHTML;\n\t\t},\n\n\t\tdisable: function disable() {\n\t\t\tthis.$element.addClass('disabled');\n\t\t\tthis.$trigger.attr('disabled', 'disabled');\n\t\t},\n\n\t\tenable: function enable() {\n\t\t\tthis.$element.removeClass('disabled');\n\t\t\tthis.$trigger.removeAttr('disabled');\n\t\t},\n\n\t\ttoggle: function toggle() {\n\t\t\tif (this.$element.hasClass('showing')) {\n\t\t\t\tthis.hide();\n\t\t\t}else{\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t},\n\n\t\thide: function hide() {\n\t\t\tif (!this.$element.hasClass('showing')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$element.removeClass('showing');\n\t\t\t$(document).off('click.fu.picker.externalClick.' + this.clickStamp);\n\t\t\tthis.$element.trigger('hidden.fu.picker');\n\t\t},\n\n\t\texternalClickListener: function externalClickListener(e, force) {\n\t\t\tif (force === true || this.isExternalClick(e)) {\n\t\t\t\tthis.complete('exited');\n\t\t\t}\n\t\t},\n\n\t\tisExternalClick: function isExternalClick(e) {\n\t\t\tvar el = this.$element.get(0);\n\t\t\tvar exceptions = this.options.externalClickExceptions || [];\n\t\t\tvar $originEl = $(e.target);\n\t\t\tvar i, l;\n\n\t\t\tif (e.target === el || $originEl.parents('.picker').get(0) === el) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tfor (i = 0, l = exceptions.length; i < l; i++) {\n\t\t\t\t\tif ($originEl.is(exceptions[i]) || $originEl.parents(exceptions[i]).length > 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tshow: function show() {\n\t\t\tvar other;\n\n\t\t\tother = $(document).find('.picker.showing');\n\t\t\tif (other.length > 0) {\n\t\t\t\tif (other.data('fu.picker') && other.data('fu.picker').options.explicit) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tother.picker('externalClickListener', {}, true);\n\t\t\t}\n\n\t\t\tthis.$element.addClass('showing');\n\n\t\t\t_display(this);\n\n\t\t\tthis.$element.trigger('shown.fu.picker');\n\n\t\t\tthis.clickStamp = new Date().getTime() + (Math.floor(Math.random() * 100) + 1);\n\t\t\tif (!this.options.explicit) {\n\t\t\t\t$(document).on('click.fu.picker.externalClick.' + this.clickStamp, langx.proxy(this.externalClickListener, this));\n\t\t\t}\n\t\t}\n\t});\n\n\tvar _isOffscreen = function _isOffscreen(picker) {\n\t\tvar windowHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n\t\tvar scrollTop = $(document).scrollTop();\n\t\tvar popupTop = picker.$popup.offset();\n\t\tvar popupBottom = popupTop.top + picker.$popup.outerHeight(true);\n\n\t\t//if the bottom of the popup goes off the page, but the top does not, dropup.\n\t\tif (popupBottom > windowHeight + scrollTop || popupTop.top < scrollTop){\n\t\t\treturn true;\n\t\t}else{//otherwise, prefer showing the top of the popup only vs the bottom\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tvar _display = function _display(picker) {\n\t\tpicker.$popup.css('visibility', 'hidden');\n\n\t\t_showBelow(picker);\n\n\t\t//if part of the popup is offscreen try to show it above\n\t\tif(_isOffscreen(picker)){\n\t\t\t_showAbove(picker);\n\n\t\t\t//if part of the popup is still offscreen, prefer cutting off the bottom\n\t\t\tif(_isOffscreen(picker)){\n\t\t\t\t_showBelow(picker);\n\t\t\t}\n\t\t}\n\n\t\tpicker.$popup.css('visibility', 'visible');\n\t};\n\n\tvar _showAbove = function _showAbove(picker) {\n\t\tpicker.$popup.css('top', - picker.$popup.outerHeight(true) + 'px');\n\t};\n\n\tvar _showBelow = function _showBelow(picker) {\n\t\tpicker.$popup.css('top', picker.$trigger.outerHeight(true) + 'px');\n\t};\n\n\n\t// PLACARD PLUGIN DEFINITION\n\n\t$.fn.picker = function picker(option) {\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tvar methodReturn;\n\n\t\tvar $set = this.each(function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar data = $this.data('fu.picker');\n\t\t\tvar options = typeof option === 'object' && option;\n\n\t\t\tif (!data) {\n\t\t\t\t$this.data('fu.picker', (data = new Picker(this, options)));\n\t\t\t}\n\n\t\t\tif (typeof option === 'string') {\n\t\t\t\tmethodReturn = data[option].apply(data, args);\n\t\t\t}\n\t\t});\n\n\t\treturn (methodReturn === undefined) ? $set : methodReturn;\n\t};\n\n\t$.fn.picker.defaults = {\n\t\tonAccept: undefined,\n\t\tonCancel: undefined,\n\t\tonExit: undefined,\n\t\texternalClickExceptions: [],\n\t\texplicit: false\n\t};\n\n\t$.fn.picker.Constructor = Picker;\n\n\t$.fn.picker.noConflict = function noConflict() {\n\t\t$.fn.picker = old;\n\t\treturn this;\n\t};\n\n\t// DATA-API\n\n\t/*\n\t$(document).on('focus.fu.picker.data-api', '[data-initialize=picker]', function (e) {\n\t\tvar $control = $(e.target).closest('.picker');\n\t\tif (!$control.data('fu.picker')) {\n\t\t\t$control.picker($control.data());\n\t\t}\n\t});\n\n\t// Must be domReady for AMD compatibility\n\t$(function () {\n\t\t$('[data-initialize=picker]').each(function () {\n\t\t\tvar $this = $(this);\n\t\t\tif ($this.data('fu.picker')) return;\n\t\t\t$this.picker($this.data());\n\t\t});\n\t});\n\t*/\n\n\treturn $.fn.picker;\n});\n"]}